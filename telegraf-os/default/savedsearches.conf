# savedsearches.conf

#  _     _
# | |   (_)_ __  _   ___  __
# | |   | | '_ \| | | \ \/ /
# | |___| | | | | |_| |>  <
# |_____|_|_| |_|\__,_/_/\_\
#

# Inventory
[telegraf-os-linux]
dispatch.earliest_time = -24h
dispatch.latest_time = now
display.general.type = statistics
display.page.search.tab = statistics
display.visualizations.show = 0
search = | mstats latest(_value) as value where `telegraf_index` metric_name="system.n_cpus" OR metric_name="mem.total" OR metric_name="swap.total" by metric_name, host\
| eval nb_cpus=case(metric_name="system.n_cpus", value), swap_total=case(metric_name="swap.total", value/1024/1024), mem_total=case(metric_name="mem.total", value/1024/1024)\
| stats first(nb_cpus) as nb_cpus, first(mem_total) as mem_total, first(swap_total) as swap_total by host\
| foreach *_total [ eval <<FIELD>> = round('<<FIELD>>', 0) ]\
| eval role="telegraf_host", family="Linux"\
| join type=inner host [ | mcatalog values(metric_name) as linux_kernel where `telegraf_index` metric_name="kernel.*" by host ] | fields - linux_kernel\
| fields host, role, family, nb_cpus, mem_total, swap_total

# file-system report
[Linux file-system report]
dispatch.earliest_time = -24h
dispatch.latest_time = now
display.general.type = statistics
display.page.search.tab = statistics
display.visualizations.show = 0
search = | mstats latest(_value) as value where `telegraf_index` metric_name=disk.used OR metric_name=disk.total OR metric_name=disk.used_percent `devices_exclusions` host=* by metric_name, path, host\
| eval {metric_name}=value\
| stats first(disk.*) as "disk.*" by host, path\
| eval "disk.total"=round(((('disk.total' / 1024) / 1024) / 1024),2), used_pct=round('disk.used_percent',2)\
| rename disk.total as "disk total (GB)"\
| fields host, path, "disk total (GB)", used_pct | rename used_pct as "disk used (%)"\
| sort 0 host, path

# __        ___           _
# \ \      / (_)_ __   __| | _____      _____
#  \ \ /\ / /| | '_ \ / _` |/ _ \ \ /\ / / __|
#   \ V  V / | | | | | (_| | (_) \ V  V /\__ \
#    \_/\_/  |_|_| |_|\__,_|\___/ \_/\_/ |___/
#

# Inventory
[telegraf-os-windows]
dispatch.earliest_time = -24h
dispatch.latest_time = now
display.general.type = statistics
display.page.search.tab = statistics
display.visualizations.show = 0
search = | mstats latest(_value) as value where `telegraf_index` metric_name=win_cpu.Percent_Idle_Time instance!=_Total by host, instance\
| stats dc(instance) as nb_cpus by host\
| join type=outer host\
    [| mstats latest(_value) as mem_total where `telegraf_index` metric_name="mem.total" by host\
    | eval mem_total=round(mem_total/1024/1024, 0) ]\
| fillnull value="NA" mem_total\
| eval role="telegraf_host", family="Windows"\
| join type=inner host\
    [| mcatalog values(metric_name) as win_metrics where `telegraf_index` metric_name="win*" by host ]\
| eval windows_ad=if(match(win_metrics, "win_ad\."), "true", "false"), windows_dns=if(match(win_metrics, "win_dns\."), "true", "false"),\
windows_dfsn=if(match(win_metrics, "win_dfsn\."), "true", "false"), windows_dfsr=if(match(win_metrics, "win_dfsr\."), "true", "false"),\
windows_iis=if(match(win_metrics, "win_websvc"), "true", "false")\
| fillnull value="false" windows_ad, windows_dns, windows_dfns, windows_dfsr, windows_iis\
| fields - win_metrics\
| fields host, role, family, nb_cpus, mem_total, windows_ad, windows_dns, windows_dfsn, windows_dfsr, windows_iis

# file-system report
[Windows file-system report]
dispatch.earliest_time = -24h
dispatch.latest_time = now
display.general.type = statistics
display.page.search.tab = statistics
display.visualizations.show = 0
search = | mstats latest(_value) as value where `telegraf_index` metric_name=win_disk.Percent_Free_Space OR metric_name=win_disk.Free_Megabytes host=* by host, metric_name, instance\
| eval {metric_name}=value\
| stats first(win_disk.*) as "*" by host, instance\
| eval used_pct=round(100-Percent_Free_Space, 2), "disk total (GB)"=round((Free_Megabytes/Percent_Free_Space)*100/1024, 2)\
| fields host, instance, "disk total (GB)", used_pct | rename used_pct as "disk used (%)"\
| sort 0 host, instance
